{"version":3,"file":"EnhancedVisualizer.jsx","sourceRoot":"","sources":["EnhancedVisualizer.tsx"],"names":[],"mappings":"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","sourcesContent":["import React, { useEffect, useRef, useState } from 'react';\nimport * as tf from '@tensorflow/tfjs';\n\ntype VisualizationMode = 'waveform' | 'spectrum' | 'particles' | 'neural';\n\ninterface EnhancedVisualizerProps {\n  audioEngine: any; // Replace with proper type\n  width?: number;\n  height?: number;\n  className?: string;\n}\n\nexport const EnhancedVisualizer: React.FC<EnhancedVisualizerProps> = ({\n  audioEngine,\n  width = 800,\n  height = 300,\n  className = ''\n}) => {\n  const canvasRef = useRef<HTMLCanvasElement>(null);\n  const [mode, setMode] = useState<VisualizationMode>('waveform');\n  const animationFrameRef = useRef<number>();\n  const [isInitialized, setIsInitialized] = useState(false);\n\n  // Initialize visualization\n  useEffect(() => {\n    if (!canvasRef.current || !audioEngine) return;\n\n    const canvas = canvasRef.current;\n    const ctx = canvas.getContext('2d');\n    if (!ctx) return;\n\n    // Set canvas dimensions\n    canvas.width = width;\n    canvas.height = height;\n\n    // Visualization loop\n    const draw = () => {\n      if (!ctx) return;\n      \n      const analyser = audioEngine.getAnalyser();\n      if (!analyser) {\n        animationFrameRef.current = requestAnimationFrame(draw);\n        return;\n      }\n\n      // Clear canvas\n      ctx.clearRect(0, 0, width, height);\n\n      // Draw based on selected mode\n      switch (mode) {\n        case 'waveform':\n          drawWaveform(ctx, analyser, width, height);\n          break;\n        case 'spectrum':\n          drawSpectrum(ctx, analyser, width, height);\n          break;\n        case 'particles':\n          drawParticles(ctx, analyser, width, height);\n          break;\n        case 'neural':\n          drawNeuralNetwork(ctx, analyser, width, height);\n          break;\n      }\n\n      animationFrameRef.current = requestAnimationFrame(draw);\n    };\n\n    // Start animation loop\n    animationFrameRef.current = requestAnimationFrame(draw);\n    setIsInitialized(true);\n\n    // Cleanup\n    return () => {\n      if (animationFrameRef.current) {\n        cancelAnimationFrame(animationFrameRef.current);\n      }\n    };\n  }, [audioEngine, mode, width, height]);\n\n  // Visualization rendering functions\n  const drawWaveform = (ctx: CanvasRenderingContext2D, analyser: AnalyserNode, width: number, height: number) => {\n    const bufferLength = analyser.frequencyBinCount;\n    const dataArray = new Uint8Array(bufferLength);\n    analyser.getByteTimeDomainData(dataArray);\n\n    ctx.lineWidth = 2;\n    ctx.strokeStyle = '#00F0FF';\n    ctx.beginPath();\n\n    const sliceWidth = (width * 1.0) / bufferLength;\n    let x = 0;\n\n    for (let i = 0; i < bufferLength; i++) {\n      const v = dataArray[i] / 128.0;\n      const y = (v * height) / 2;\n\n      if (i === 0) {\n        ctx.moveTo(x, y);\n      } else {\n        ctx.lineTo(x, y);\n      }\n\n      x += sliceWidth;\n    }\n\n    ctx.lineTo(width, height / 2);\n    ctx.stroke();\n  };\n\n  const drawSpectrum = (ctx: CanvasRenderingContext2D, analyser: AnalyserNode, width: number, height: number) => {\n    const bufferLength = analyser.frequencyBinCount;\n    const dataArray = new Uint8Array(bufferLength);\n    analyser.getByteFrequencyData(dataArray);\n\n    const barWidth = (width / bufferLength) * 2.5;\n    let x = 0;\n\n    for (let i = 0; i < bufferLength; i++) {\n      const barHeight = (dataArray[i] / 255) * height;\n      \n      // Create gradient for each bar\n      const gradient = ctx.createLinearGradient(0, height, 0, height - barHeight);\n      gradient.addColorStop(0, '#00F0FF');\n      gradient.addColorStop(1, '#7C3AED');\n      \n      ctx.fillStyle = gradient;\n      ctx.fillRect(x, height - barHeight, barWidth, barHeight);\n      \n      x += barWidth + 1;\n    }\n  };\n\n  const drawParticles = (ctx: CanvasRenderingContext2D, analyser: AnalyserNode, width: number, height: number) => {\n    const bufferLength = analyser.frequencyBinCount;\n    const dataArray = new Uint8Array(bufferLength);\n    analyser.getByteFrequencyData(dataArray);\n\n    // Clear with semi-transparent black for trail effect\n    ctx.fillStyle = 'rgba(0, 0, 0, 0.1)';\n    ctx.fillRect(0, 0, width, height);\n\n    const particleCount = 100;\n    const segment = Math.floor(bufferLength / particleCount);\n\n    for (let i = 0; i < particleCount; i++) {\n      const value = dataArray[i * segment] / 255;\n      const x = (i / particleCount) * width;\n      const y = height - (value * height);\n      const radius = 2 + (value * 8);\n      \n      // Create radial gradient for particles\n      const gradient = ctx.createRadialGradient(x, y, 0, x, y, radius);\n      gradient.addColorStop(0, 'rgba(124, 58, 237, 0.8)');\n      gradient.addColorStop(1, 'rgba(0, 240, 255, 0.2)');\n      \n      ctx.fillStyle = gradient;\n      ctx.beginPath();\n      ctx.arc(x, y, radius, 0, Math.PI * 2);\n      ctx.fill();\n    }\n  };\n\n  const drawNeuralNetwork = (ctx: CanvasRenderingContext2D, analyser: AnalyserNode, width: number, height: number) => {\n    const bufferLength = analyser.frequencyBinCount;\n    const dataArray = new Uint8Array(bufferLength);\n    analyser.getByteFrequencyData(dataArray);\n\n    // Clear with dark background\n    ctx.fillStyle = 'rgba(17, 24, 39, 0.8)';\n    ctx.fillRect(0, 0, width, height);\n\n    // Draw neural network connections\n    const nodes = 8;\n    const layers = 4;\n    const nodeRadius = 8;\n    const layerSpacing = width / (layers + 1);\n    \n    // Draw connections\n    for (let l = 0; l < layers - 1; l++) {\n      const x1 = (l + 1) * layerSpacing;\n      const x2 = (l + 2) * layerSpacing;\n      \n      for (let i = 0; i < nodes; i++) {\n        const y1 = ((i + 1) * height) / (nodes + 1);\n        \n        for (let j = 0; j < nodes; j++) {\n          const y2 = ((j + 1) * height) / (nodes + 1);\n          const value = dataArray[((l * nodes) + i + j) % bufferLength] / 255;\n          \n          ctx.strokeStyle = `rgba(0, 240, 255, ${value * 0.3})`;\n          ctx.lineWidth = value * 2;\n          \n          ctx.beginPath();\n          ctx.moveTo(x1, y1);\n          ctx.quadraticCurveTo(x1 + (x2 - x1) / 2, (y1 + y2) / 2, x2, y2);\n          ctx.stroke();\n        }\n      }\n    }\n    \n    // Draw nodes\n    for (let l = 0; l < layers; l++) {\n      const x = (l + 1) * layerSpacing;\n      \n      for (let i = 0; i < nodes; i++) {\n        const y = ((i + 1) * height) / (nodes + 1);\n        const value = dataArray[((l * nodes) + i) % bufferLength] / 255;\n        \n        // Node glow\n        const gradient = ctx.createRadialGradient(x, y, 0, x, y, nodeRadius * 2);\n        gradient.addColorStop(0, `rgba(0, 240, 255, ${value})`);\n        gradient.addColorStop(1, 'rgba(0, 240, 255, 0)');\n        \n        ctx.fillStyle = gradient;\n        ctx.beginPath();\n        ctx.arc(x, y, nodeRadius * 2, 0, Math.PI * 2);\n        ctx.fill();\n        \n        // Node core\n        ctx.fillStyle = `rgba(0, 240, 255, ${0.5 + (value * 0.5)})`;\n        ctx.beginPath();\n        ctx.arc(x, y, nodeRadius, 0, Math.PI * 2);\n        ctx.fill();\n      }\n    }\n  };\n\n  if (!isInitialized) {\n    return (\n      <div className={`${className} bg-gray-900/50 flex items-center justify-center`} style={{ width, height }}>\n        <div className=\"animate-pulse text-gray-500\">Initializing visualization...</div>\n      </div>\n    );\n  }\n\n  return (\n    <div className={`relative ${className}`} style={{ width, height }}>\n      <canvas\n        ref={canvasRef}\n        width={width}\n        height={height}\n        className=\"w-full h-full rounded-lg\"\n      />\n      \n      {/* Visualization mode selector */}\n      <div className=\"absolute bottom-2 right-2 flex space-x-2\">\n        {(['waveform', 'spectrum', 'particles', 'neural'] as VisualizationMode[]).map((m) => (\n          <button\n            key={m}\n            onClick={() => setMode(m)}\n            className={`px-3 py-1 text-xs rounded-full transition-colors ${\n              mode === m \n                ? 'bg-cyan-600 text-white' \n                : 'bg-gray-800/70 text-gray-300 hover:bg-gray-700/70'\n            }`}\n          >\n            {m.charAt(0).toUpperCase() + m.slice(1)}\n          </button>\n        ))}\n      </div>\n    </div>\n  );\n};\n\nexport default EnhancedVisualizer;\n"]}